<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Provides a lightweight and flexible access control list (ACL) implementation for privileges management">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Expression Assertions - zend-permissions-acl</title>

    <link rel="stylesheet" href="../css/styles-e3f3751b65.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    <div class="subnavigation hidden-print">
    <h4 class="subnavigation__title">
        <a href="..">zend-permissions-acl</a>
    </h4>

    <h5 class="subnavigation__subtitle">Table of Contents</h5>

    <ul class="subnavigation__list">
        
            
                <li class="subnavigation__list-item ">
                    <a href=".." class="subnavigation__link">zend-permissions-acl</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../usage/" class="subnavigation__link">Theory and Usage</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../refining/" class="subnavigation__link">Refining ACLs</a>
                </li>
            
        
            
                <li class="subnavigation__list-item">
                    <span class="subnavigation__headline">Reference</span>
                    <ul class="subnavigation__list">
                        
                            
    <li class="subnavigation__list-item ">
        <a href="../ownership/" class="subnavigation__link">Ownership Assertions</a>
    </li>

                        
                            
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Expression Assertions</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../advanced/" class="subnavigation__link">Advanced Usage</a>
    </li>

                        
                    </ul>
                </li>
            
        
    </ul>
</div>
                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-permissions-acl</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-permissions-acl/" class="header__link header__link--github" title="Go to repository of zend-permissions-acl">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="https://framework.zend.com/">Home</a></li>
  <li><a href="https://docs.zendframework.com/">Docs</a></li>
  <li><a href="..">zend-permissions-acl</a></li>
  
    
      
        <li>Reference</li>
      
    
  
  <li class="active">Expression Assertions</li>
</ol>


    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#operands" class="toc__link">Operands</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#operators" class="toc__link">Operators</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#constructors" class="toc__link">Constructors</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#examples" class="toc__link">Examples</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="expression-assertions">Expression Assertions</h1>
<ul>
<li>Since 2.7.0</li>
</ul>
<p>Many custom assertions are doing basic comparisons:</p>
<ul>
<li>Equality of a role property to a value or property of the resource.</li>
<li>Other comparisons (<code>&gt;</code>, <code>&lt;</code>, <code>in_array</code>, etc.) of a role property to a value
  or values (potentially a property of the resource).</li>
<li>Regular expressions.</li>
</ul>
<p>While these can be easily accommodated by the <code>CallbackAssertion</code>, such
assertions have one notable problem: they cannot be easily serialized.</p>
<p>To facilitate such assertions, we now provide
<code>Zend\Permissions\Acl\Assertion\ExpressionAssertion</code>. This class provides two
static factory methods for creating an instance, each expecting the following:</p>
<ul>
<li>The left operand</li>
<li>An operator</li>
<li>The right operand</li>
</ul>
<p>When the assertion is executed, it uses the operator to determine how to compare
the two operands, and thus answer the assertion.</p>
<h2 id="operands">Operands</h2>
<p>The operands can be any PHP value.</p>
<p>Additionally, they can be an associative array containing the key
<code>ExpressionAssertion::OPERAND_CONTEXT_PROPERTY</code> (<code>__context</code>), with a string
value.</p>
<p>That value can be one of the following:</p>
<ul>
<li>
<p>A string matching the values "acl", "privilege", "role", or "resource", with
  the latter two being most common. When one of these is provided, the
  corresponding argument to the <code>assert()</code> method will be used.</p>
</li>
<li>
<p>A dot-separated string with the first segment being one of the above values,
  and the second being a property or field of that object. The
  <code>ExpressionAssertion</code> will test for:</p>
</li>
<li>
<p>a method matching <code>get&lt;field&gt;()</code></p>
</li>
<li>a method matching <code>is&lt;field&gt;()</code></li>
<li>a public property named <code>&lt;field&gt;</code></li>
</ul>
<p>in that specific order. In the first two cases, <code>&lt;field&gt;</code> will be normalized
  to WordCase when creating the method name to test.</p>
<h2 id="operators">Operators</h2>
<p><code>ExpressionAssertion</code> supports the following operators:</p>
<pre class="codehilite"><code class="language-php">    const OPERATOR_EQ     = '=';
    const OPERATOR_NEQ    = '!=';
    const OPERATOR_LT     = '&lt;';
    const OPERATOR_LTE    = '&lt;=';
    const OPERATOR_GT     = '&gt;';
    const OPERATOR_GTE    = '&gt;=';
    const OPERATOR_IN     = 'in';
    const OPERATOR_NIN    = '!in';
    const OPERATOR_REGEX  = 'regex';
    const OPERATOR_NREGEX = '!regex';
    const OPERATOR_SAME   = '===';
    const OPERATOR_NSAME  = '!==';</code></pre>

<p>In most cases, these will operate using the operators as listed above, with the
following exceptions:</p>
<ul>
<li><code>OPERATOR_EQ</code> will use <code>==</code> as the comparison operator; <code>OPERATOR_NEQ</code> will
  likewise use <code>!=</code>.</li>
<li><code>OPERATOR_IN</code> and <code>OPERATOR_NIN</code> use <code>in_array()</code> (with the latter negating
  the result), both doing strict comparisons. The right hand operand is expected
  to be the array in which to look for results, and the left hand operand is
  expected to be the needle to look for.</li>
<li><code>OPERATOR_REGEX</code> and <code>OPERATOR_NREGEX</code> will perform a <code>preg_match()</code>
  operation, using the right hand operand as the regular expression, and the
  left hand operand as the value to compare.</li>
</ul>
<h2 id="constructors">Constructors</h2>
<p>The constructor of <code>ExpressionAssertion</code> is private. Instead, you will use one
of two static methods in order to create instances:</p>
<ul>
<li><code>fromProperties($left, $operator, $right)</code></li>
<li><code>fromArray(array $expression)</code> (expects keys for "left", "operator", and "right")</li>
</ul>
<p>When creating expressions manually, the first is generally the best choice. When
storing expressions in configuration or a database, the latter is useful, as you
can pass a row of data at a time to the method to get expression instances.</p>
<h2 id="examples">Examples</h2>
<p>First, we'll define both a role and a resource:</p>
<pre class="codehilite"><code class="language-php">namespace Blog\Entity;

use Zend\Permissions\Acl\Resource\ResourceInterface;
use Zend\Permissions\Acl\Role\RoleInterface;

class BlogPost implements ResourceInterface
{
    public $title;

    public $shortDescription;

    public $content;

    public $author;

    public function __construct(array $data = [])
    {
        foreach ($data as $property =&gt; $value) {
            $this-&gt;$property = $value;
        }
    }

    public function getResourceId()
    {
        return 'blogPost';
    }

    public function getShortDescription()
    {
        return $this-&gt;shortDescription;
    }

    public function getAuthorName()
    {
        return $this-&gt;author ? $this-&gt;author-&gt;username : '';
    }
}

class User implements RoleInterface
{
    public $username;

    public $role = 'guest';

    public $age;

    public function __construct(array $data = [])
    {
        foreach ($data as $property =&gt; $value) {
            $this-&gt;$property = $value;
        }
    }

    public function getRoleId()
    {
        return $this-&gt;role;
    }

    public function isAdult()
    {
        return $this-&gt;age &gt;= 18;
    }
}</code></pre>

<p>Next, let's define some assertions.</p>
<pre class="codehilite"><code class="language-php">use Zend\Permissions\Acl\Assertion\ExpressionAssertion;

// Username of role must be &quot;test&quot;:
// Will access $username property on the role instance.
$isTestUser = ExpressionAssertion::fromProperties(
  [ExpressionAssertion::OPERAND_CONTEXT_PROPERTY =&gt; 'role.username'],
  '===',
  'test'
);


// Role must be at least 18 years old:
// Will execute `isAdult()` on the role instance.
$isOfLegalAge = ExpressionAssertion::fromProperties(
  [ExpressionAssertion::OPERAND_CONTEXT_PROPERTY =&gt; 'role.adult'],
  '===',
  true
);

// Must have edited text:
// Will do a regex comparison on the shortDescription of the blog post
// to ensure we do not have filler text.
$isEditedDescription = ExpressionAssertion::fromArray([
  'left'     =&gt; [ExpressionAssertion::OPERAND_CONTEXT_PROPERTY =&gt; 'resource.shortDescription'],
  'operator' =&gt; '!regex',
  'right'    =&gt; '/lorem ipsum/i',
]);</code></pre>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../ownership/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../advanced/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>


<div class="help-wanted">
    <p>
        Found a mistake or want to contribute to the documentation?
        <a href="https://github.com/zendframework/zend-permissions-acl/edit/master/docs/expression.md" target="_blank" class="help-wanted__link">
            Edit this page on GitHub!
        </a>
    </p>
</div>
                
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    <div class="subnavigation hidden-print">
    <h4 class="subnavigation__title">
        <a href="..">zend-permissions-acl</a>
    </h4>

    <h5 class="subnavigation__subtitle">Table of Contents</h5>

    <ul class="subnavigation__list">
        
            
                <li class="subnavigation__list-item ">
                    <a href=".." class="subnavigation__link">zend-permissions-acl</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../usage/" class="subnavigation__link">Theory and Usage</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../refining/" class="subnavigation__link">Refining ACLs</a>
                </li>
            
        
            
                <li class="subnavigation__list-item">
                    <span class="subnavigation__headline">Reference</span>
                    <ul class="subnavigation__list">
                        
                            
    <li class="subnavigation__list-item ">
        <a href="../ownership/" class="subnavigation__link">Ownership Assertions</a>
    </li>

                        
                            
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Expression Assertions</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../advanced/" class="subnavigation__link">Advanced Usage</a>
    </li>

                        
                    </ul>
                </li>
            
        
    </ul>
</div>
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2018 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '..',
            siteName = 'zend-permissions-acl';
    </script>
    <script src="../js/scripts-dcbafde59f.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
